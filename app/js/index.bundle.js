(()=>{var e={41:()=>{Array.prototype.sum=function(){return this.reduce(((e,t)=>e+t))},HTMLElement.prototype.addClass=function(e){new RegExp(`^${e}$|^${e} | ${e}$| ${e}( )`,"g").test(this.className)||(this.className=`${this.className} ${e}`.trim())},HTMLElement.prototype.removeClass=function(e){const t=new RegExp(`^${e}$|^${e} | ${e}$| ${e}( )`,"g");this.className=this.className.replace(t,"$1").trim()},HTMLCollection.prototype.toArray=function(){return[...this]},NodeList.prototype.toArray=function(){return[...this]}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{"use strict";n(41);const e=["debug","info","warning","error"],t={log_level:"debug",get debug(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("debug")?console.debug.bind(window.console,"%cDEBUG  :","color: #6c757d"):()=>{}},get info(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("info")?console.info.bind(window.console,"%cINFO   :","color: #17a2b8"):()=>{}},get warning(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("warning")?console.warn.bind(window.console,"%cWARNING:","color: #ffc107"):()=>{}},get error(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("error")?console.error.bind(window.error,"%cERROR  :","color: #dc3545"):()=>{}}},o=new Proxy({},{get:(e,n)=>{if("origin"===n)return e;const o=window.localStorage[n];try{return o&&JSON.parse(o)}catch(e){return t.error("storage: Parse json fail, key: ",n)}},set:(e,t,n)=>(window.localStorage[t]=JSON.stringify(n),e[t]=n,!0)});let r=o.wallpapers;r||(r=[{url:"img/w1.jpg",active:!0},{url:"img/w2.jpg",active:!0},{url:"img/w3.jpg",active:!0}],o.wallpapers=r),r=r.filter((e=>e.active));const i=r[Math.floor(Math.random()*r.length)];i&&(window.wall.style.backgroundImage=`url(${i.url})`,setTimeout((()=>{window.wall_ghost_left.style.backgroundImage=`url(${i.url})`,window.wall_ghost_right.style.backgroundImage=`url(${i.url})`}),500));const a={pool:{},emit:(e,...t)=>{for(const n of a.pool[e]??[])n(...t)},on:(e,t)=>{a.pool[e]?.push(t)||(a.pool[e]=[t])},next:(e,...t)=>{setTimeout(a.emit,0,e,...t)}},s=a,l={mounted:{},gen:(e,n)=>{if(l[e]||!/^[a-zA-Z][a-zA-Z0-9_]{0,63}$/.test(e))return t.error(`emitter: Name "${e}" existed or invalid`);l[e]=()=>{if(l.mounted[e])return t.error(`emitter: Duplicate mount emitter ${e}`);n(),l.mounted[e]=!0}}};l.gen("click",(()=>{function e(t,n,o=0){if(o>5||!t)return;const r=t.getAttribute("click-emit");if(!r)return e(t.parentElement,n,o+1);const i=r.split(":")[0];let a=r.split(":").slice(1).join(":");if("?"===a[0]){const e={};a.slice(1).split("&").forEach((t=>{const[n,o]=t.split("=");""!==n&&(e[n]=o)})),a=e}s.next(i,a,{target:t,domEvent:n})}window.document.body.addEventListener("click",(t=>{e(t.target,t)})),t.info("emiter: Click emiter mounted")}));const c=l,d={throttle:(e=200,t=!0)=>{const n={lock:!1,handle:null,execute:(o,...r)=>{n.handle=o,n.lock||(n.lock=!0,n.handle=null,n.handle(...r),setTimeout((()=>{n.lock=!1,t&&n.handle&&n.execute(n.handle,...r)}),e))}};return n},debounce:(e=200)=>{const t={timeout:null,execute:(n,...o)=>{clearTimeout(t.timeout),t.timeout=setTimeout(n,e,...o)}};return t},raf:()=>{const e={lock:!1,handle:null,execute:(t,...n)=>{e.handle=t,e.lock||(e.lock=!0,window.requestAnimationFrame((()=>{e.lock=!1,e.handle(...n)})))}};return e}},u={MAX_NOTE_NUMBER:300,MAX_NOTE_CHARACTER:3e3,notes:[],call:{save:d.debounce(2e3),move:d.raf()},fetch:()=>{chrome.storage.local.get(["notes","version"]).then((e=>{u.notes=e.notes||[],u.render(),chrome.storage.sync.get().then((n=>{if(n.version>e.version){u.notes=[];for(const[e,t]of Object.entries(n))e.startsWith("note:")&&u.notes.push(t);u.render(),chrome.storage.local.set({notes:u.notes,version:n.version}),t.debug("noter: Render sync data")}else n.version<e.version&&u.sync(e.version)}))}))},save:()=>{const e=Date.now();chrome.storage.local.set({notes:u.notes,version:e}),u.sync(e),t.debug("noter: Noter save:",u.notes)},sync:e=>{const n={version:e},o=[];chrome.storage.sync.get().then((e=>{for(const[t,n]of Object.entries(e))t.startsWith("note:")&&!u.notes.find((e=>e.id===n.id))&&o.push(t);for(const e of u.notes)n[`note:${e.id}`]=e;u.call.save.execute((()=>{chrome.storage.sync.set(n),chrome.storage.sync.remove(o),t.debug("noter: Sync done",{update:n,removes:o})}))}))},createObject:e=>{const t={msg:"",x:Math.floor(Math.random()*(holder.w_w-500)),y:Math.floor(Math.random()*(holder.w_h-250)),w:300,h:100,workspace:o.workspace,status:"default"};return Object.assign(t,e)},createElement:e=>{const{id:t,msg:n,x:o,y:r,w:i,h:a,status:s}=e,l=document.createElement("div");return l.setAttribute("id",`noteid_${t}`),l.setAttribute("class","note"),l.setAttribute("style",`transform: translate(${o}px, ${r}px)`),l.setAttribute("note-status",s||"default"),l.innerHTML=`\n    <div class="note-box">\n        <div class="note-controls" note-move-id="${t}">\n            <div class="note-remove" click-emit="note_remove:${t}">&times;</div>\n        </div>\n        <div class="note-rainbow">\n            <div click-emit="note_mark:${t},primary"></div>\n            <div click-emit="note_mark:${t},success"></div>\n            <div click-emit="note_mark:${t},danger"></div>\n        </div>\n        <textarea\n            autocomplete="off"\n            autocorrect="off"\n            autocapitalize="off"\n            spellcheck="false"\n            note-editor-id="${t}"\n            style="width:${i}px;height:${a-20}px;"\n        >${n}</textarea>\n    </div>`,l},add:e=>{if(u.notes.length>u.MAX_NOTE_NUMBER)return window.alert("The maximum number of notes has been reached");void 0===e.id&&(e.id=Date.now().toString(),u.notes.push(e)),window.note_box.appendChild(u.createElement(e))},render:(e=!0,n=+o.workspace||0)=>{e&&(window.note_box.innerHTML="");for(const e of u.notes)n===e.workspace&&u.add(e);t.debug("noter: Render note",u.notes)},checkAndReplaceCode:e=>{const t=e.value;holder.code_tables.forEach((n=>{const o=new RegExp(n.code),r=t.match(o);if(r){const i=r.slice(1),a=e.selectionStart,s=e.value;let l=n.value;i.forEach((e=>{l=l.replace("$",e)})),e.value=t.replace(o,l);const c=a+e.value.length-s.length;e.setSelectionRange(c,c)}}))},remove:e=>{const t=u.notes.findIndex((t=>t.id==e));u.notes.splice(t,1);const n=window[`noteid_${e}`];n.parentElement.removeChild(n),u.save()},mark:(e,t)=>{const n=u.notes.find((t=>t.id==e));n.status===t?n.status="default":n.status=t,window[`noteid_${e}`].setAttribute("note-status",n.status),u.save()},handleOnChange:({target:e,key:t})=>{const n=e.getAttribute("note-editor-id");if(n){const o=u.notes.findIndex((e=>e.id==n));if(u.notes[o].msg===e.value)return;if("="===t&&u.checkAndReplaceCode(e),e.value.length>u.MAX_NOTE_CHARACTER)return window.alert("The maximum character has been reached");u.notes[o].msg=e.value,u.save()}},boot:()=>{const e={resize:!1,move:!1,deltaX:0,deltaY:0};s.on("note_remove",(e=>{u.remove(e)})),s.on("note_mark",(e=>{const[t,n]=e.split(",");u.mark(t,n)})),window.note_box.addEventListener("mousedown",(t=>{if(3===t.which)return;const{target:n}=t;if(null!==n.getAttribute("note-editor-id")){const o=t.clientX,r=t.clientY,i=+n.getAttribute("note-editor-id"),a=u.notes.findIndex((e=>e.id==i)),s=u.notes[a];s.x+s.w-o<15&&s.y+s.h-r<15&&(e.resize=i)}if(null!==n.getAttribute("note-move-id")){const o=+n.getAttribute("note-move-id"),r=u.notes.findIndex((e=>e.id==o));e.deltaX=t.clientX-u.notes[r].x,e.deltaY=t.clientY-u.notes[r].y,e.move=o}})),window.addEventListener("mousemove",(t=>{!1!==e.move&&(t.preventDefault(),u.call.move.execute((()=>{const n=window[`noteid_${e.move}`];if(n){const o=Math.min(holder.w_w-20,Math.max(t.clientX-e.deltaX,0)),r=Math.min(holder.w_h-20,Math.max(t.clientY-e.deltaY,0));n.style.transform=`translate(${o}px, ${r}px)`}})))})),window.addEventListener("mouseup",(t=>{if(!1!==e.move){const n=t.clientX-e.deltaX,o=t.clientY-e.deltaY,r=u.notes.findIndex((t=>t.id==e.move));-1!==r&&(u.notes[r].x=n,u.notes[r].y=o),e.move=!1,u.save()}else if(!1!==e.resize){const t=u.notes.findIndex((t=>t.id==e.resize)),n=window["noteid_"+e.resize].offsetWidth,o=window["noteid_"+e.resize].offsetHeight;-1!==t&&(u.notes[t].w=n,u.notes[t].h=o),e.resize=!1,u.save()}})),window.note_box.addEventListener("keyup",u.handleOnChange),window.note_box.addEventListener("paste",u.handleOnChange),s.on("noter_add",(()=>{u.add(u.createObject()),u.save()})),s.on("noter_switch_workspace",(()=>{let e=+o.workspace||0;e>2?e=0:e++,window.switch_workspace_btn.innerHTML=e,o.workspace=e,u.save(),u.render()})),chrome.storage.onChanged.addListener(((e,t)=>{document.hidden&&"local"===t&&e.notes&&(u.notes=e.notes.newValue,u.render())})),u.fetch()}},w=u,m={bookmarkBarElement:window.bookmark_bar,create:e=>{const{url:t,title:n,children:o}=e;return o?(setTimeout((()=>m.render(e))),""):`\n    <a class="item" href="${t}">\n        <img src="${chrome.runtime.getURL("/_favicon/")}?pageUrl=${t}">\n        <div class="title">${n}</div>\n    </a>`},createParent:e=>{const t=e.title,n=e.children.map((e=>m.create(e))).join(""),r=`${t}-${e.parentId||"root"}`;return`\n    <div class="parent ${o[`bookmark:parent:${r}`]||"open"}">\n        <div class="parent-header" data-parent-id="${r}">\n            <span class="icon icon-folder"></span>\n            <div class="label">${t}</div>\n        </div>\n        <div class="stopgrap"></div>\n        <div class="parent-childs">${n}</div>\n    </div>`},render:(e,t=!1)=>{t&&(m.bookmarkBarElement.innerHTML=""),m.bookmarkBarElement.innerHTML+=m.createParent(e)},toggleOpenParent:e=>{const t="close"===o[`bookmark:parent:${e}`]?"open":"close";o[`bookmark:parent:${e}`]=t,document.querySelector(`[data-parent-id="${e}"]`).parentNode.className=`parent ${t}`},fetch:()=>{chrome.topSites.get((e=>{m.render({children:e,title:"Most visited"},!0),chrome.bookmarks.getTree((e=>{m.render(e[0].children[0])}))}))},boot:()=>{m.bookmarkBarElement.addEventListener("click",(({target:e})=>{const t=e.getAttribute("data-parent-id")||e.parentNode.getAttribute("data-parent-id");t&&m.toggleOpenParent(t)})),chrome.bookmarks.onCreated.addListener(m.fetch),chrome.bookmarks.onRemoved.addListener(m.fetch),chrome.bookmarks.onChanged.addListener(m.fetch),chrome.bookmarks.onMoved.addListener(m.fetch),m.fetch()}},g=m,p=(e,t)=>{window.wave_click_box.innerHTML=`\n    <div class="wave active" style="transform: translate(${e}px, ${t}px)">\n        <div></div>\n        <div></div>\n        <div></div>\n    </div>`};window.addEventListener("mouseup",(e=>{p(e.clientX,e.clientY)}));const h={isOpen:!1,blob_buffer_url:null,render:()=>{const e=window.settings_wallpapers.clientWidth/6-10,t=e*holder.w_h/holder.w_w;3===o.wallpapers.length&&(o.wallpapers=[...o.wallpapers,...new Array(5).fill({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQYV2M4c+bMfwAIMANkq3cY2wAAAABJRU5ErkJggg"})]),window.settings_wallpapers.innerHTML=o.wallpapers.map(((n,o)=>{let r="settings-wall-pre";n.active&&(r+=" active");let i="";return o>=3&&(i+=`<span click-emit="setting_wallpaper_edit:${o}">EDIT</span>`),`\n            <div\n                class="${r}"\n                style="width: ${e}px; height: ${t}px; background-image: url(${n.url})"\n                click-emit="setting_wallpaper_toggle:${o}"\n            >${i}</div>\n            `})).join(""),window.setting_config_input.value=JSON.stringify(o.config).replace(/,/g,",\n").replace("{","{\n").replace("}","\n}"),window.setting_code_table_input.value=holder.code_tables.map((e=>`${e.code.slice(0,-2)} -> ${e.value}`)).join("\n")},toggle:e=>{void 0===e&&(e=!h.isOpen),h.isOpen=e,e?(window.setting_box.removeClass("hidden"),h.render()):window.setting_box.addClass("hidden")}};s.on("setting_close",(()=>{h.toggle(!1)})),s.on("setting_open",(()=>{h.toggle(!0)})),s.on("setting_backup",(()=>{const e=new Date,t={};t.notes=w.notes,t.storage=JSON.parse(JSON.stringify(window.localStorage));const n=JSON.stringify(t),o=new Blob([n],{type:"text/plain"});null!==h.blob_buffer_url&&window.URL.revokeObjectURL(h.blob_buffer_url),h.blob_buffer_url=window.URL.createObjectURL(o);const r=document.createElement("a");r.href=h.blob_buffer_url,r.download="sein-backup-"+e.toLocaleDateString().replace(/\//g,"-")+".json",r.click()})),s.on("setting_restore",(()=>{const e=document.createElement("input");e.type="file",e.addEventListener("change",(()=>{const t=e.files[0],n=new FileReader;n.addEventListener("load",(()=>{const e=n.result,t=JSON.parse(e),{notes:o,storage:r}=t;w.notes=o,w.save(),Object.keys(r).forEach((e=>{window.localStorage[e]=r[e]})),window.alert("Restore completed"),window.location.reload()})),n.readAsText(t)}),{once:!0}),e.click()})),s.on("setting_config_save",(()=>{try{const e=JSON.parse(window.setting_config_input.value);o.config=e}catch(e){return window.alert("Parse config error")}window.alert("Save config success")})),s.on("setting_wallpaper_toggle",((e,{target:t})=>{e=+e;const n=o.wallpapers,r=-1!==t.className.indexOf("active");r?t.removeClass("active"):t.addClass("active"),n[e].active=!r,o.wallpapers=n})),s.on("setting_wallpaper_edit",((e,{target:t})=>{e=+e;const n=document.createElement("input");n.type="file",n.addEventListener("change",(()=>{const r=n.files[0],i=new FileReader;if(r.size>1048576)return window.alert("Image must be less than 1 megabytes");i.addEventListener("load",(()=>{const n=o.wallpapers;n[e].url=i.result,o.wallpapers=n,t.parentElement.style.backgroundImage=`url(${i.result})`})),i.readAsDataURL(r)}),{once:!0}),n.click()})),s.on("setting_wallpaper_reset",(()=>{o.wallpapers=null,window.location.reload()})),window.holder={w_w:window.document.documentElement.clientWidth,w_h:window.document.documentElement.clientHeight,code_tables:[{code:"date==",value:(new Date).toLocaleDateString()},{code:"time==",value:(new Date).toLocaleTimeString()},{code:"now==",value:(new Date).toLocaleString()}]},window.addEventListener("resize",(()=>{holder.w_w=window.document.documentElement.clientWidth,holder.w_h=window.document.documentElement.clientHeight})),w.boot(),g.boot(),c.click(),o.config=o.config||{log_level:"debug"},t.log_level=o.config.log_level,window.switch_workspace_btn.innerHTML=o.workspace||0})()})();