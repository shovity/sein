(()=>{var e={41:()=>{Array.prototype.sum=function(){return this.reduce(((e,t)=>e+t))},HTMLElement.prototype.addClass=function(e){new RegExp(`^${e}$|^${e} | ${e}$| ${e}( )`,"g").test(this.className)||(this.className=`${this.className} ${e}`.trim())},HTMLElement.prototype.removeClass=function(e){const t=new RegExp(`^${e}$|^${e} | ${e}$| ${e}( )`,"g");this.className=this.className.replace(t,"$1").trim()},HTMLCollection.prototype.toArray=function(){return[...this]},NodeList.prototype.toArray=function(){return[...this]}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{"use strict";n(41);const e=["debug","info","warning","error"],t={log_level:"debug",get debug(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("debug")?console.debug.bind(window.console,"%cDEBUG:","color: #6c757d"):()=>{}},get info(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("info")?console.info.bind(window.console,"%cINFO:","color: #17a2b8"):()=>{}},get warning(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("warning")?console.warn.bind(window.console,"%cWARNING:","color: #ffc107"):()=>{}},get error(){return e.indexOf(this.log_level.toLowerCase())<=e.indexOf("error")?console.error.bind(window.error,"%cERROR:","color: #dc3545"):()=>{}}},o=new Proxy({},{get:(e,n)=>{if("origin"===n)return e;const o=window.localStorage[n];try{return o&&JSON.parse(o)}catch(e){return t.error("storage: parse json fail, key: ",n)}},set:(e,t,n)=>(window.localStorage[t]=JSON.stringify(n),e[t]=n,!0)});let r=o.wallpapers;r||(r=[{url:"img/w1.jpg",active:!0},{url:"img/w2.jpg",active:!0},{url:"img/w3.jpg",active:!0}],o.wallpapers=r),r=r.filter((e=>e.active));const i=r[Math.floor(Math.random()*r.length)];i&&(window.wall.style.backgroundImage=`url(${i.url})`,setTimeout((()=>{window.wall_ghost_left.style.backgroundImage=`url(${i.url})`,window.wall_ghost_right.style.backgroundImage=`url(${i.url})`}),500));const a={pool:{hi:[e=>{console.log("")},e=>{console.log("")},e=>{console.log("")}]},emit:(e,...t)=>{for(const n of a.pool[e]??[])n(...t)},on:(e,t)=>{a.pool[e]?.push(t)||(a.pool[e]=[t])},next:(e,...t)=>{setTimeout(a.emit,0,e,...t)}},s=a,l={},d={};l.mounted=d,l.gen=(e,n)=>{if(l[e]||!/^[a-zA-Z][a-zA-Z0-9_]{0,63}$/.test(e))return t.error(`emitter: name "${e}" existed or invalid`);l[e]=()=>{if(d[e])return t.error(`emitter: duplicate mount emitter ${e}`);n(),d[e]=!0}};const c=1;l.gen("click",(()=>{const e=1;function n(t,o,r=0){if(r>5||!t)return;console.log(e,c);const i=t.getAttribute("click-emit");if(!i)return n(t.parentElement,o,r+1);const a=i.split(":")[0];let l=i.split(":").slice(1).join(":");if("?"===l[0]){const e={};l.slice(1).split("&").forEach((t=>{const[n,o]=t.split("=");""!==n&&(e[n]=o)})),l=e}s.next(a,l,{target:t,domEvent:o})}window.document.body.addEventListener("click",(e=>{n(e.target,e)})),t.info("emiter: click emiter mounted")}));const w=l,g={notes:[],MAX_NOTE_NUMBER:300,MAX_NOTE_CHARACTER:3e3,fetch:()=>{chrome.storage.local.get("notes").then((({notes:e})=>{g.notes=e,g.render()}))},save:()=>{t.debug("noter save:",g.notes),chrome.storage.local.set({notes:g.notes})},createObject:e=>{const t={msg:"",x:Math.floor(Math.random()*(holder.w_w-500)),y:Math.floor(Math.random()*(holder.w_h-250)),w:300,h:100,workspace:o.workspace,status:"default"};return Object.assign(t,e)},createElement:e=>{const{id:t,msg:n,x:o,y:r,w:i,h:a,status:s}=e,l=document.createElement("div");return l.setAttribute("id",`noteid_${t}`),l.setAttribute("class","note"),l.setAttribute("style",`transform: translate(${o}px, ${r}px)`),l.setAttribute("note-status",s||"default"),l.innerHTML=`\n    <div class="box">\n        <div class="note-controls" move-noteid="${t}">\n            <div class="note-remove" remove-noteid="${t}">&times;</div>\n        </div>\n        <div class="rain-bow">\n            <div mark="${t}:primary"></div>\n            <div mark="${t}:success"></div>\n            <div mark="${t}:danger"></div>\n        </div>\n        <textarea\n            autocomplete="off"\n            autocorrect="off"\n            autocapitalize="off"\n            spellcheck="false"\n            editor-noteid="${t}"\n            style="width:${i}px;height:${a-20}px;"\n        >${n}</textarea>\n    </div>`,l},add:e=>{if(g.notes.length>g.MAX_NOTE_NUMBER)return window.alert("The maximum number of notes has been reached");void 0===e.id&&(e.id=Date.now().toString(),g.notes.push(e)),t.debug(`add note ${e.id} = ${e.msg}`),window.note_box.appendChild(g.createElement(e))},render:(e=!0,t=+o.workspace||0)=>{e&&(window.note_box.innerHTML=""),g.notes.filter((e=>t===+e.workspace)).forEach((e=>{g.add(e)}))},checkAndReplaceCode:e=>{const t=e.value;holder.code_tables.forEach((n=>{const o=new RegExp(n.code),r=t.match(o);if(r){const i=r.slice(1),a=e.selectionStart,s=e.value;let l=n.value;i.forEach((e=>{l=l.replace("$",e)})),e.value=t.replace(o,l);const d=a+e.value.length-s.length;e.setSelectionRange(d,d)}}))},remove:e=>{const t=g.notes.findIndex((t=>t.id==e));g.notes.splice(t,1);const n=window[`noteid_${e}`];n.parentElement.removeChild(n),g.save()},mark:(e,t)=>{const n=g.notes.find((t=>t.id==e));n.status===t?n.status="default":n.status=t,window[`noteid_${e}`].setAttribute("note-status",n.status),g.save()},boot:()=>{let e=!1,t=!1,n=0,r=0;window.note_box.addEventListener("click",(e=>{const{target:t}=e,n=t.getAttribute("remove-noteid"),o=t.getAttribute("mark");if(n)g.remove(n);else if(o){const[e,t]=o.split(":");g.mark(e,t)}})),window.note_box.addEventListener("mousedown",(o=>{if(3===o.which)return;const{target:i}=o;if(null!==i.getAttribute("editor-noteid")){const t=o.clientX,n=o.clientY,r=+i.getAttribute("editor-noteid"),a=g.notes.findIndex((e=>e.id==r)),s=g.notes[a];s.x+s.w-t<15&&s.y+s.h-n<15&&(e=r)}if(null!==i.getAttribute("move-noteid")){const e=+i.getAttribute("move-noteid"),a=g.notes.findIndex((t=>t.id==e));n=o.clientX-g.notes[a].x,r=o.clientY-g.notes[a].y,t=e}})),window.addEventListener("mousemove",(e=>{if(!1===t)return;e.preventDefault();let o=e.clientX-n,i=e.clientY-r;i<0&&(i=0),i>holder.w_h-20&&(i=holder.w_h-20),o<0&&(o=0),o>holder.w_w-20&&(o=holder.w_w-20),window[`noteid_${t}`]&&(window[`noteid_${t}`].style.transform=`translate(${o}px, ${i}px)`)})),window.addEventListener("mouseup",(o=>{if(!1!==t){const e=o.clientX-n,i=o.clientY-r,a=g.notes.findIndex((e=>e.id==t));-1!==a&&(g.notes[a].x=e,g.notes[a].y=i),t=!1,g.save()}else if(!1!==e){const t=g.notes.findIndex((t=>t.id==e)),n=window["noteid_"+e].offsetWidth,o=window["noteid_"+e].offsetHeight;-1!==t&&(g.notes[t].w=n,g.notes[t].h=o),e=!1,g.save()}})),window.note_box.addEventListener("keyup",(({target:e,key:t})=>{const n=e.getAttribute("editor-noteid");if(n){const o=g.notes.findIndex((e=>e.id==n));if("="===t&&g.checkAndReplaceCode(e),e.value.length>g.MAX_NOTE_CHARACTER)return window.alert("The maximum character has been reached");g.notes[o].msg=e.value,g.save()}})),s.on("noter_add",(()=>{g.add(g.createObject()),g.save()})),s.on("noter_switch_workspace",(()=>{let e=+o.workspace||0;e>2?e=0:e++,window.switch_workspace_btn.innerHTML=e,o.workspace=e,g.save(),g.render()})),chrome.storage.onChanged.addListener(((e,t)=>{"local"===t&&e.notes&&document.hidden&&(g.notes=e.notes.newValue,g.render())})),g.fetch()}},u=g,p={bookmarkBarElement:window.bookmark_bar,create:e=>{const{url:t,title:n,children:o}=e;return o?(setTimeout((()=>p.render(e))),""):`\n    <a class="item" href="${t}">\n        <img src="${chrome.runtime.getURL("/_favicon/")}?pageUrl=${t}">\n        <div class="title">${n}</div>\n    </a>`},createParent:e=>{const t=e.title,n=e.children.map((e=>p.create(e))).join(""),r=`${t}-${e.parentId||"root"}`;return`\n    <div class="parent ${o[`bookmark:parent:${r}`]||"open"}">\n        <div class="parent-header" data-parent-id="${r}">\n            <span class="icon icon-folder"></span>\n            <div class="label">${t}</div>\n        </div>\n        <div class="stopgrap"></div>\n        <div class="parent-childs">${n}</div>\n    </div>`},render:(e,t=!1)=>{t&&(p.bookmarkBarElement.innerHTML=""),p.bookmarkBarElement.innerHTML+=p.createParent(e)},toggleOpenParent:e=>{const t="close"===o[`bookmark:parent:${e}`]?"open":"close";o[`bookmark:parent:${e}`]=t,document.querySelector(`[data-parent-id="${e}"]`).parentNode.className=`parent ${t}`},fetch:()=>{chrome.topSites.get((e=>{p.render({children:e,title:"Most visited"},!0),chrome.bookmarks.getTree((e=>{p.render(e[0].children[0])}))}))},boot:()=>{p.bookmarkBarElement.addEventListener("click",(({target:e})=>{const t=e.getAttribute("data-parent-id")||e.parentNode.getAttribute("data-parent-id");t&&p.toggleOpenParent(t)})),chrome.bookmarks.onCreated.addListener(p.fetch),chrome.bookmarks.onRemoved.addListener(p.fetch),chrome.bookmarks.onChanged.addListener(p.fetch),chrome.bookmarks.onMoved.addListener(p.fetch),p.fetch()}},m=p,h=(e,t)=>{window.wave_click_box.innerHTML=`\n    <div class="wave active" style="transform: translate(${e}px, ${t}px)">\n        <div></div>\n        <div></div>\n        <div></div>\n    </div>`};window.addEventListener("mouseup",(e=>{h(e.clientX,e.clientY)}));const f={isOpen:!1,blob_buffer_url:null,render:()=>{const e=window.settings_wallpapers.clientWidth/6-10,t=e*holder.w_h/holder.w_w;3===o.wallpapers.length&&(o.wallpapers=[...o.wallpapers,...new Array(5).fill({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQYV2M4c+bMfwAIMANkq3cY2wAAAABJRU5ErkJggg"})]),window.settings_wallpapers.innerHTML=o.wallpapers.map(((n,o)=>{let r="settings-wall-pre";n.active&&(r+=" active");let i="";return o>=3&&(i+=`<span click-emit="setting_wallpaper_edit:${o}">EDIT</span>`),`\n        <div\n            class="${r}"\n            style="width: ${e}px; height: ${t}px; background-image: url(${n.url})"\n            click-emit="setting_wallpaper_toggle:${o}"\n        >${i}</div>\n        `})).join(""),window.setting_config_input.value=JSON.stringify(o.config).replace(/,/g,",\n").replace("{","{\n").replace("}","\n}"),window.setting_code_table_input.value=holder.code_tables.map((e=>`${e.code.slice(0,-2)} -> ${e.value}`)).join("\n")},toggle:e=>{void 0===e&&(e=!f.isOpen),f.isOpen=e,e?(window.setting_box.removeClass("hidden"),f.render()):window.setting_box.addClass("hidden")}};s.on("setting_close",(()=>{f.toggle(!1)})),s.on("setting_open",(()=>{f.toggle(!0)})),s.on("setting_backup",(()=>{const e=new Date,t={};t.notes=u.notes,t.storage=JSON.parse(JSON.stringify(window.localStorage));const n=JSON.stringify(t),o=new Blob([n],{type:"text/plain"});null!==f.blob_buffer_url&&window.URL.revokeObjectURL(f.blob_buffer_url),f.blob_buffer_url=window.URL.createObjectURL(o);const r=document.createElement("a");r.href=f.blob_buffer_url,r.download="sein-backup-"+e.toLocaleDateString().replace(/\//g,"-")+".json",r.click()})),s.on("setting_restore",(()=>{const e=document.createElement("input");e.type="file",e.addEventListener("change",(()=>{const t=e.files[0],n=new FileReader;n.addEventListener("load",(()=>{const e=n.result,t=JSON.parse(e),{notes:o,storage:r}=t;u.notes=o,u.save(),Object.keys(r).forEach((e=>{window.localStorage[e]=r[e]})),window.alert("Restore completed"),window.location.reload()})),n.readAsText(t)}),{once:!0}),e.click()})),s.on("setting_config_save",(()=>{try{const e=JSON.parse(window.setting_config_input.value);o.config=e}catch(e){return window.alert("Parse config error")}window.alert("Save config success")})),s.on("setting_wallpaper_toggle",((e,{target:t})=>{e=+e;const n=o.wallpapers,r=-1!==t.className.indexOf("active");r?t.removeClass("active"):t.addClass("active"),n[e].active=!r,o.wallpapers=n})),s.on("setting_wallpaper_edit",((e,{target:t})=>{e=+e;const n=document.createElement("input");n.type="file",n.addEventListener("change",(()=>{const r=n.files[0],i=new FileReader;if(r.size>1048576)return window.alert("Image must be less than 1 megabytes");i.addEventListener("load",(()=>{const n=o.wallpapers;n[e].url=i.result,o.wallpapers=n,t.parentElement.style.backgroundImage=`url(${i.result})`})),i.readAsDataURL(r)}),{once:!0}),n.click()})),s.on("setting_wallpaper_reset",(()=>{o.wallpapers=null,window.location.reload()})),window.holder={w_w:window.document.documentElement.clientWidth,w_h:window.document.documentElement.clientHeight,code_tables:[{code:"date==",value:(new Date).toLocaleDateString()},{code:"time==",value:(new Date).toLocaleTimeString()},{code:"now==",value:(new Date).toLocaleString()}]},window.addEventListener("resize",(()=>{holder.w_w=window.document.documentElement.clientWidth,holder.w_h=window.document.documentElement.clientHeight})),u.boot(),m.boot(),w.click(),o.config=o.config||{log_level:"debug"},t.log_level=o.config.log_level,window.switch_workspace_btn.innerHTML=o.workspace||0})()})();